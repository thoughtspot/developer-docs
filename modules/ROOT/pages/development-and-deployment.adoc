= Development and deployment in ThoughtSpot
:toc: true
:toclevels: 2

:page-title: Development and deployment in ThoughtSpot
:page-pageid: development-and-deployment
:page-description: Overview of development and deployment following the SDLC practices in ThoughtSpot

When deploying embedded analytics, each organization will have defined practices for development, testing, and deployment of content to ThoughtSpot. 

ThoughtSpot instances act as a constantly running service, so deployment only involves *ThoughtSpot data models and content*.

ThoughtSpot provides numerous tools for building a structured deployment process, built around the link:https://cloud-docs.thoughtspot.com/admin/ts-cloud/tml.html[ThoughtSpot Modeling Language (TML), window=_blank] format for representing the xref:intro-thoughtspot-objects.adoc[objects within ThoughtSpot].

== Best practices
The primary tool for structured development and deployment in ThoughtSpot is called Orgs. 

Orgs are fully separated tenants on a single ThoughtSpot instance.

For TSE customers and others who need a structured development and deployment process, Orgs should always be enabled.

When Orgs are enabled, the Primary Org (org_id: 0) should be treated as the "root" or "super-admin" Org, and all "real content" should exist on Orgs other than the Primary.

If you have used ThoughtSpot for a long time and are enabling Orgs for the first time, please see xref:moving-to-orgs.adoc[moving to Orgs from single-tenant ThoughtSpot instance].

== Standard Orgs structure

- Primary - for instance administration
- Dev - ThoughtSpot customer internal team building data models and standard Liveboards and Answers
- Prod - Data models and standard content is published to here by serivce account. End customer's get READ-ONLY access to data models, standard LBs and Answers. 

RLS filters the shared data models so that standard LBs and Answers only show the right data for each End Customer

=== Additions to the standard model:

- Internal Org(s): Org(s) for ThoughtSpot customer's own business work, never to be shared with end customers
- Test, UAT: Additional steps in the publishing process between Dev and Prod, for verification before changes are deployed into Prod
- Prod Org Per End Customer (Org Per Customer): If Data Warehouse is Single Tenanted (logical separation for each end customer, such that a different connection is necessary), then "Prod" is actually One Prod Org Per End Customer
- Separate 'dev' instance: Some people want a fully separated environment for dev, especially if doing MAJOR changes, even to cluster config. Recommend there be a 'Test Org' on the 'Prod Instance' to push to first, before pushing to 'Prod'
- Separate regional instances: 

== Deploying content between environments

The workflow for a very simple "dev" to "prod" flow on the same environment shown here, is the same pattern for any source-to-destination environment flow:

image::./images/development-deployment-process.png[Development and deployment workflow]

=== Git(Hub) Integration
The Git APIs are already designed for "build on Dev Org, deploy to prod/prod per customer/test then uat then prod"

There is a Mapping File that automatically records the GUIDs from "dev" to all of the other Orgs when you use the /vcs/git/commits/deploy REST API endpoint. 

There is a 'secret functionality' for defining changes to the Table TML (and Connection TML) within the mapping file. This lets you 'variablize' the Table and Connection TML today.

=== TML Export/Import APIs
Everything done via the /vcs/git/ REST APIs can also be done within your own coded workflows using the /metadata/tml/export and /metadata/tml/import REST APIs. 

You will need some form of GUID Mapping file that records the originalGuid of the source object and the mappedGuid of the object in the destination Org, at the time it is first created. 

== Multi-tenancy and data security
The exact deployment pattern chosen will depend on the design of your data warehouse. 

At a basic level:

- if the *prod data warehouse* is *multi-tenanted* - all end customer data is in *the same* tables - then a single Prod Org can be used, with row-level security (RLS) and proper access control (sharing) configured to present 
- if the *prod data warehouse* is *single-tenant* - each end customer's data is separated in different databases or schemas - then a Prod Org Per End Customer is the typical pattern within ThoughtSpot

The actual level of multi-tenant Org separation is totally up to ThoughtSpot Customer, dependent on their business requirements

