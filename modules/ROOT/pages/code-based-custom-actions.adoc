= Code based custom actions
:toc: true
:toclevels: 2

:page-title: Code based custom actions
:page-pageid: code-based-custom-action
:page-description: You can add custom buttons or menu items in your ThoughtSpot code to the ThoughtSpot UI to let your application users to analyze insights and trigger an action on the data.

Code-based custom actions are custom menu items that you define within the application's code through the Visual Embed SDK.

These custom actions add a new menu item to one of the following UI elements in an Answer, Liveboard, visualization, or in the Spotter interface:

* the primary menu bar (except for Spotter)
* the **More** options menu image:./images/icon-more-10px.png[the more options menu]
* the contextual menu that appears when a user right-clicks on an Answer or visualization (except for Liveboard)


=== Components of a code based custom action interface

[width="100%" cols="4,5"]
[options='header']
|===
|parameter|description

|`name`|_String._ Display name for the custom action.
|`id`|_String._ Unique identifier for the action.
|`position` a|Position where the action should be rendered. Valid values include: +

* CustomActionsPosition.MENU
* CustomActionsPosition.PRIMARY
* CustomActionsPosition.CONTEXTMENU

|`target` a|The target object type where the action applies. Valid values include: +

* CustomActionTarget.LIVEBOARD
* CustomActionTarget.VIZ
* CustomActionTarget.ANSWER
* CustomActionTarget.SPOTTER

|`metadataIds` a|_Optional_. Metadata-based filtering for actions. Valid values include: +

* `answerIds`: Applicable Answer GUIDs
* `liveboardIds`: Applicable Liveboard GUIDs
* `vizIds`: Applicable Viz GUIDs
* `dataModelIds`: Data model GUIDs, Column names from data models
|`orgIds`| Restrict visibility to specific orgs. Unique identifier for the org(s).
|`groupIds`| Restrict visibility to specific groups. Unique identifier for the group(s).
|===

=== Code based custom action for Liveboards

The custom action is applied on a specific Liveboard, the `liveboardIds` is passed in the `metadataIds`.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: CustomActionPosition.PRIMARY,
        target: CustomActionTarget.LIVEBOARD,
        metadataIds: {
            liveboardIds: ['lb1'],
        },
    },
];

----

The custom action is applied on a specific Liveboard with restricted visibility for a group of users in a particular Org. The `liveboardIds` is passed in the `metadataIds` along with the `groupId` and the `orgId`.

[source,javascript]
----
const customActions = [
    {
        name : "CA1",
        id: "ca1",
        position: CustomActionPosition.PRIMARY,
        target: CustomActionTarget.LIVEBOARD,
        metadataIds: {
            liveboardId: ['lb1'],
        },
        groupId: ['grp1'],
        orgId: ['org1'],
    }
]
----

=== Code based custom action for Visualizations

The custom action is applied on all visualizations on a specific Liveboard, the `liveboardIds` is passed in the `metadataIds`. This custom action will also be visible to all new users who have access to the Liveboard.


[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position:CustomActionPosition.PRIMARY,
        target: CustomActionTarget.VIZ,
        metadataIds: {
            liveboardIds: ['lb1']
        },
    },
];
----

The custom action is applied on a specific visualization, the `vizIds` is passed in the `metadataIds`.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: CustomActionPosition.PRIMARY,
	    target: CustomActionTarget.VIZ,
        metadataIds: {
            vizIds: ['viz1']
        },
    },
];
----


When both `liveboardIds` and `vizIds` parameters are provided, the system will perform a union of all visualizations associated with the specified `liveboardIds` and the visualizations explicitly referenced by the provided `vizIds` values.

In this example, Liveboard lb1 contains visualizations viz11 and viz12. Another Liveboard, lb2, contains visualizations viz21 and viz22.

* For Liveboard lb2, a custom action will be displayed on all visualizations, since the liveboardId is present.

* The custom action will also be shown only on the visualization with the id viz11 for Liveboard lb1.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: CustomActionPosition.PRIMARY,
        target: CustomActionTarget.VIZ,
        metadataIds: {
            liveboardIds: ['lb2'],
		    vizIds: ['viz21', 'viz11']
        },
    },
];
----

When either `groupId`, `orgId`, or both are provided, custom actions will be displayed only for the visualization for the members of the specified groupId within the specified orgId.

In this example, Liveboard lb1 contains visualizations viz11 and viz12. Another Liveboard, lb2, contains visualizations viz21 and viz22. For a user who is part of org1 and grp1,

* The custom action will be displayed on all visualizations of Liveboard lb2, since the liveboardId is present.

* The custom action will also be shown for visualization viz11.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: CustomActionPosition.PRIMARY,
	    target: CustomActionTarget.VIZ,
        metadataIds: {
            liveboardIds: ['lb2'],
		    vizIds: ['viz21', 'viz11']
        },
        groupId: ['grp1'],
        orgId: ['org1']
    },
];
----

When the answerId parameter is provided, the system displays custom actions only on the visualization(s) that use the specified underlying answerId.

For example, consider a Liveboard (lb1) with three visualizations: viz1 (based on ans1), viz2 (based on ans2), and viz3 (based on ans3).

* The custom action will be displayed on all visualizations of Liveboard lb2, since the liveboardId is present.

* The custom action will also be shown for viz1 and viz 3, as viz1 is explicitly included by vizId, and viz3 uses the specified answerId (ans3) as its underlying data source.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: 'CustomActionPosition.PRIMARY,
	    target: CustomActionTarget.VIZ,
        metadataIds: {
            liveboardIds: ['lb2'],
		    vizIds: ['viz1'],
            answerIds: ['ans3']
        },
    },

----

When `worksheetId` is passed in the `dataModelIds`, then the custom action is show for all visualization which are using the columns of the specified worksheet.

In this example,

* The custom action will be displayed on all visualizations of Liveboard lb2, since the liveboardId is present.

* The custom action will also be shown for all visualizations built using the column(s) of worksheet1.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: 'CustomActionPosition.PRIMARY,
	    target: CustomActionTarget.VIZ,
        metadataIds: {
            liveboardIds: ['lb2'],
        },
        dataModelIds: {
            modelIds: ['worksheet1']
	  }
    },
];

----

When columnIds are provided, the custom action will be displayed only on visualizations that are created using the specified columnIds.

In this example,

* The custom action will be displayed on all visualizations of Liveboard lb2, since the liveboardId is present.

* The custom action will also be shown for all visualizations built using the col1 of worksheet1.


[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: 'CustomActionPosition.PRIMARY,
	    target: CustomActionTarget.VIZ,
        metadataIds: {
            liveboardIds: ['lb2'],
        },
        dataModelIds: {
            modelColumnNames: ["worksheet1::col1"]
    },
];

----


////
In this example,

* If the column is a part of the specified worksheet, the custom action will be shown for visualizations or answers built using col1 of worksheet1.
* If the column is not a part of the specified worksheet,
** The custom action will be shown for all visualizations or answers built using worksheet1, irrespective of the column.
** The custom action will be shown for all visualizations or answers built using worksheet1, irrespective of the column.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: 'CustomActionPosition.PRIMARY,
	    target: CustomActionTarget.VIZ,
        metadataIds: {
            liveboardIds: ['lb2'],
        },
        dataModelIds: {
            modelIds: ["worksheet1"],
            modelColumnNames: ["col1"]
    },
];

----
////


=== Code based custom action for Answers

The custom action is applied on a specific Answer, the `answerIds` is passed in the `metadataIds`.

[source,javascript]
----
const customActions = [
{
name: 'CA1',
id: 'ca1',
position: CustomActionsPosition.PRIMARY,
target: CustomActionTarget.ANSWER,
metadataIds: {
answerIds: ['ans1'],
},
},
];

----

When a worksheetId or columnNames are specified, the custom action will be displayed for all answers which use the specified worksheet.
In this example,

* The custom action will be displayed for ans1, since the answerId is present.

* The custom action will also be shown for all answers using worksheet1.

[source,javascript]
----
const customActions = [
{
        name: "CA1",
id: 'ca1',
position: "answer_primary",
callback: (payload) => console.log('payload', payload);
metadataIds: {
answerIds: ['ans1'],
},
dataModelIds: {
worksheetIds: [worksheet1]
},
},
];
----

When either `groupId`, `orgId`, or both are provided, custom actions will be displayed only for the members of the specified groupId within the specified orgId, on the answers with the given answerId.


[source,javascript]
----
const customActions = [
{
name: 'CA1',
id: 'ca1',
position: CustomActionsPosition.PRIMARY,
target: CustomActionTarget.ANSWER,
metadataIds: {
answerIds: ['ans1'],
},
groupId: ['grp1'],
        orgId: ['org1'],
},
];

----

=== Code based custom action for Spotter

When a modelId is specified, custom actions will be displayed on all answers and visualizations generated from that model, as well as in any Liveboard where these answers have been pinned.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: CustomActionPosition.PRIMARY,
	    target: CustomActionTarget.SPOTTER,
        dataModelIds: {
            modelIds: ['model1']
        },
    },
];
----


When a vizId or answerId is specified, custom actions will not be displayed in Spotter. Instead, custom actions will only be shown on the specific answers or visualizations whose IDs have been provided. This configuration is mostly used in full application embed scenarios.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: CustomActionPosition.PRIMARY,
	    target: CustomActionTarget.SPOTTER,
        metadataIds: {
            vizIds: ['viz1']
        },
    },
];
----

When either `groupId`, `orgId`, or both are provided, custom actions will be displayed on all answers and visualizations generated from that model, as well as in any Liveboard where these answers have been pinned. This will be shown only for the members with the specific groupId within the specified orgId.

In this example, for a user who is part of org1 and grp1,

* The custom action will be displayed for answers and visualizations generated from model1.

* The custom action will also be shown in any Liveboard where these answers have been pinned.

[source,javascript]
----
const customActions = [
    {
        name: 'CA1',
        id: 'ca1',
        position: CustomActionPosition.PRIMARY,
	    target: CustomActionTarget.SPOTTER,
        dataModelIds: {
            modelIds: ['model1']
        },
        groupId: ['grp1'],
        orgId: ['org1']
    },
];
----